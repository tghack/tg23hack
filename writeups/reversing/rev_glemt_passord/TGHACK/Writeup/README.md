# Writeup [Glemt passord](./README.md)

## Writeup

Graver enn litt rundt i koden gjennom eks. IDA finner vi en anonym `Init` funksjon som kaller en `deserialize` funksjon.
```cpp
unsigned __int64 __fastcall `anonymous namespace'::Init::Init(_anonymous_namespace_::Init *this)
{
  return deserialize(stuff);
}
```
Ser vi på innholdet i `stuff`, finner vi en lang sekvens med bytes. I `derserialize` så gjøres `stuff` om til instanser av klassen `TG23::User`.
Gjennskaper vi `deserialize` kan vi da enkelt hente ut innholdet. Fra `main` finner vi også at klassen har en funksjon `check_password` fra dette ser vi at passordet er kryptert med 1 byte XOR.

```python
from itertools import cycle
stuff = bytes.fromhex('2D0105617564726101281927271D132B2B1E32123F7D723D01292125132B3A337D19037F780C7C332B2D25292018232425730200024A0105627265617201291C2E3A141201323F1A2E26414632033C3A3242263710454F113E40212C2517341C3A10470105451E020200027601076372797374696501154C3C46170B4E1B08164816464F0A141A3A0F34161E0200027F0104626574680117644754282961405C7976597E27477B622977497B4820450200021001046265626501237B46577070707E64035354787F5842684B6064655765584148760666457943017948070200023101066E6F6C616E610124547C4049726E7C4416114B554E424D765172484B137661111F6961166B457F776C4F6B140200022601056E657373610126392F151C0634182C3C2F14680A696B1F27146A0A2A6B183907673B3917142A270C11080C152E0200025E01066368616E646101271F05315130272E2D3E0E5B260505240A221A225C330108205D242E1C2B3A5D30105A3F3C2331380200026901066261646D696E011A66276F7B57652D604D53426D467E56786F7A5F7174612274507F0200021501046361736901217B14361D1A77040F26220A25023E0C2D7D79057B380D2714191E390B177C28037F0200024E010563696C6B6101252B566E632E532D4957206C20752A7B7075686E782073605F634C547472785C4C60604D564C020002190107646F72616C796E01292C2F2D323027190815170D2B28243132190717563020202B2E080A2735270C2F0B391620302A0D0E5902000261010677696C6C797401274F6E697C536F69634B535703534A0F0E0F4B76480F52705C7575766C43436E566A77517468550C0200023A0109616C656A616E647261011742347E76357E4C685D614C4E6D456D6A734A6B487374680200020701087468656F646F7261011E78496C09497C5C5F765977700A4F0E525B576E03020F0E0E76770B71570E0200023A0106666C6F726973011A235B5353456578564170416559775C215C4B28575840476945610200021101056D617474790122281130120C3A2C353F3B2249092931191B14101214161E114C0134354C0D223D142A0200027801096A61637175657474650117797471537403606F550F7B570F756E545859404245074102000236010567656E6E610127625C64414E4B7A6265517F4A4870486A11447C4A511C414B734E5A6D6E7A4D786B451F7E68186F020002290107666C61676D696E011F607306074F535B50145055595A145758554747514714475B14595147474D4902010234010762657274696E6501292E3A1E2024300245431810403B21021810123E03211602060C1E161F38381F0E1904250344133C2E3C0200027401066E657373696501174C2C25585E7025556D4A7378586A646B5054722D4852520200021C01067374657068690118217D07391A793B36052D22182B3B3C3C343926377A2820790200024E01056265726E79011D555F76577A5D0B6F594E7F74576B7F73634D0B097F736E6B0D545308580200023B010873686F7368616E6101296E4D504B3B5B405761523276496F6A5A54555B6573785B49456E7041525A6A4B7836547451724A405602000202010B616C6D6F737461646D696E0115602440557C757C655A635D72506F607C7453417E7D0200021701056D6F6C6C6901156B1617652A3801673D2862641C1E082301302108640200025201066D697373696501194E66784A5666674C5C0E5066725D075C4F5B687A77075372460200023F0105636F6E6E6901214D5D64437F24255F637E7253417D42464647506D625B264F6766627264447F6E7C0200021701066F64656C6C65011A2B28143733320D36231224295431121014075934221805112B1602000261010967656F726769616E6101250950133B093501220F141925313154522401263913042F27205756243A3622365539142D320200026301046164616E0129495E41305C346B716D4E3C71686E3677314E355274485450516074674753687C36535C3571685141750200020401067361726974610125525735100808170A2E0D3A04285702590139072D575617151305263850190854392905160A0200026001066D616E64696501221C2F287D230879393D7B30077B06780C2D3D1D072C32253F2D2F3E7E190B091D071C0200024A01056B656C6C7901295C787D667A635B2C64607064255A247F5C4C4C715F4C77515056275360232747617C74792C7C5071560200021501046479616E0118014C0D43537D724D41087672725B680A7D535E49580E410E0200023901086E6F7461646D696E01227E22665557736F737A4243465947526F43677525782072632265755C65554F726E450200021601084D616C6C6F7269650115785846791E484448494A424B5C7C684A4346606E150200022D0106477261796365012033710F2929280E34077B030606061A1538712504082D10072173183571722B17020002420105496C69736501242467514D65562E66657221654E21535D5140265E6D542364205C76217E63675D53715E2F0200021701054E616F6D61011C51461475526E4314775612761C144C654D53744B6E6915746F146E6C0200022401054D69636B79011947533978733C473071395A51447F584E5A536E64534B3A457F020002090108456D6D616C796E6E011519504540516F456D4A60636C13706D77776C664F770200022101084777656E65747465011F42685F1F5C4C48496C67434C591E6446467865685D605E1E7F1B73684251780200022B0106416C69736F6E01223E313C131121020A1C303329323B0C2B1D3C1729120A4F4D174E1413134C32353C3402000278000000')

num_elements = stuff[0]; stuff=stuff[1:]
def parse_type(_type, stuff):
    _value = None
    if _type == 1: # string
        _length = stuff[0]; stuff = stuff[1:]
        _value = stuff[:_length]; stuff = stuff[_length:]
    if _type == 2: # int
        _value = stuff[0]; stuff = stuff[1:]
    return stuff, _value

for element in range(num_elements):
    # Username
    _type = stuff[0]; stuff = stuff[1:]
    stuff, username = parse_type(_type, stuff)
    # Password
    _type = stuff[0]; stuff = stuff[1:]
    stuff, enc_password = parse_type(_type, stuff)
    # is admin
    _type = stuff[0]; stuff = stuff[1:]
    stuff, is_admin = parse_type(_type, stuff)
    # XOR key
    _type = stuff[0]; stuff = stuff[1:]
    stuff, xor_key = parse_type(_type, stuff)
    password = bytes([a^xor_key for a in enc_password])
    print(username, password)
```

Vi finner da brukeren `flagmin` og passordet som er flagget: `TG23{god damn classes so messy}`
